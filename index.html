<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Stellytoe Crawler</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-4 col-md-4 col-lg-4">
                <h4>Stellytoe Image Crawler</h4>
                <form>
                    <div class="form-group">
                        <label for="my_url">URL</label>
                        <input type="text" class="form-control" id="my_url" name="my_url" value="https://steelytoe.com/dev.titudev.com//api/v1/resources/master_file_tagging">
                    </div>
                    <div class="form-group">
                        <label for="my_event">Event Name</label>
                        <select class="form-control" id="my_event" name="my_event">
                            <option value="BOROBUDUR MARATHON 2023">BOROBUDUR MARATHON 2023</option>
                            <option value="FRIENDSHIP-RUN-SEMARANG-2023">BOROBUDUR FRIENDSHIP RUN 2023</option>
                            <option value="FRIENDSHIP-RUN-SEMARANG-2022">BOROBUDUR FRIENDSHIP RUN 2022</option>
                            <option value="SEMARANG-10K-2022">Semarang 10K 2022</option>
                            <option value="SEMARANG-10K-2023">Semarang 10K 2023</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="my_bib">BIB/Name Search</label>
                        <input type="text" class="form-control" id="my_bib" name="my_bib">
                    </div>
                    <div class="form-group">
                        <label for="my_location">Location, e.g., startline, KM 10, etc</label>
                        <input type="text" class="form-control" id="my_location" name="my_location">
                    </div>

                    <div class="form-group">
                        <label for="my_pagesize">Page Size</label>
                        <input type="text" class="form-control" id="my_pagesize" name="my_pagesize" value="100">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_location">
                        <label class="form-check-label" for="filter_location">
                            Filter by Location
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_bib">
                        <label class="form-check-label" for="filter_bib">
                            Filter by BIB/Name
                        </label>
                    </div>

                    <button type="button" class="btn btn-primary w-100">Search!</button>

                    <!-- Existing HTML structure with the form and other elements -->

                    <div class="row m-3">
                        <h5 id="my_log"></h5>

                    </div>
                    <!-- Buttons for navigation -->
                    <div class="row ml-1 mt-2 d-none" id="my_buttons">
                        <button type="button" class="btn btn-secondary mx-1" id="my_firstButton">First</button>
                        <button type="button" class="btn btn-secondary mx-1" id="my_previousButton">Previous</button>
                        <button type="button" class="btn btn-secondary mx-1" id="my_nextButton">Next</button>
                        <button type="button" class="btn btn-secondary mx-1" id="my_lastButton">Last</button>

                    </div>

                </form>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8 mt-4">
                <div class="col-lg-12">
                    <div id="div2">

                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="" id="modalImage" class="img-fluid" alt="Modal Image">
                </div>
            </div>
        </div>
    </div>



    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Your jQuery functionality can go here -->
    <script>
        $(document).ready(function () {

            $('button').click(function () {
                var url = $('#my_url').val();
                var pageSize = $('#my_pagesize').val();
                var eventName = $('#my_event').val();
                var queryParams = {
                    pageSize: pageSize,
                    pageNumber: 1,
                    sort: '+mftgPhotoDate',
                    'filter[mftgEventName]': eventName
                };

                var bibSearch = $('#my_bib').val();
                var locationValue = $('#my_location').val();

                var locationFilter = $('#filter_location').prop('checked');
                var bibFilter = $('#filter_bib').prop('checked');

                if (locationFilter) {
                    queryParams['filter[mftgPhotoLocation][like]'] = '%' + locationValue + '%';
                }
                if (bibFilter) {
                    queryParams['filter[mftgDescription][like]'] = '%' + bibSearch + '%';
                }
                $('#div2').html('');

                $.ajax({
                    url: url,
                    method: 'GET',
                    data: queryParams,
                    success: function (response) {
                        var imageList = '<div class="row">';
                        $.each(response.data, function (index, photo) {
                            imageList += '<div class="col-lg-3 col-sm-3 col-md-3">';
                            imageList += '<img src="' + photo.mftgUrl + '" class="img-fluid mb-2 image-popup" alt="Event Image" data-toggle="modal" data-target="#imageModal" data-image="' + photo.mftgUrl + '">';
                            imageList += '<small>'
                            imageList += '<p><strong>Location:</strong> ' + photo.mftgPhotoLocation + '</p>';
                            imageList += '</small></div>';
                        });
                        imageList += '</div>';
                        $('#div2').html(imageList);
                        // Open modal on image click
                        $('.image-popup').click(function () {
                            var imageUrl = $(this).data('image');
                            $('#modalImage').attr('src', imageUrl);
                        });
                        $('#my_log').html('Total ada ' + response.status.totalRecords + 'Foto');
                        $('#my_buttons').removeClass('d-none');
                        updateNavigation(response.status.totalRecords, queryParams);
                    },

                    error: function (xhr, status, error) {
                        // Handle errors here
                        console.error(status + ": " + error);
                        $('#my_log').html(status + ": " + error);
                    }
                });


            });

            // Function to update navigation buttons
            function updateNavigation(totalRecords, params) {
                var queryParams = params;
                var pageSize = $('#my_pagesize').val();
                var totalPages = Math.ceil(totalRecords / pageSize);
                var $firstButton = $('#my_firstButton');
                var $previousButton = $('#my_previousButton');
                var $nextButton = $('#my_nextButton');
                var $lastButton = $('#my_lastButton');

                $nextButton.off('click');
                $previousButton.off('click');
                $lastButton.off('click');
                $firstButton.off('click');

                $firstButton.click(function () {
                    queryParams.pageNumber = 1;
                    triggerAjax(queryParams);
                });

                $previousButton.click(function () {
                    var newPagenumber = queryParams.pageNumber - 1;
                    if (newPagenumber >= 1) {
                        queryParams.pageNumber--;
                        triggerAjax(queryParams);
                    }
                });

                $nextButton.click(function () {
                    var newPagenumber = queryParams.pageNumber + 1;
                    if (newPagenumber < totalPages) {
                        queryParams.pageNumber++;
                        triggerAjax(queryParams);
                    }
                });

                $lastButton.click(function () {
                    queryParams.pageNumber = totalPages;
                    triggerAjax(queryParams);
                });


            };
            function triggerAjax(params) {
                // Make AJAX call with updated page number (queryParams.pageNumber)
                var url = $('#my_url').val();
                var queryParams = params;
                console.log(queryParams);
                $.ajax({
                    url: url,
                    method: 'GET',
                    data: queryParams,
                    success: function (response) {
                        var imageList = '<div class="row">';
                        $.each(response.data, function (index, photo) {
                            imageList += '<div class="col-lg-3 col-sm-3 col-md-3">';
                            imageList += '<img src="' + photo.mftgUrl + '" class="img-fluid mb-2 image-popup" alt="Event Image" data-toggle="modal" data-target="#imageModal" data-image="' + photo.mftgUrl + '">';
                            imageList += '<small>'
                            imageList += '<p><strong>Location:</strong> ' + photo.mftgPhotoLocation + '</p>';
                            imageList += '</small></div>';
                        });
                        imageList += '</div>';
                        $('#div2').html(imageList);
                        // Open modal on image click
                        $('.image-popup').click(function () {
                            var imageUrl = $(this).data('image');
                            $('#modalImage').attr('src', imageUrl);
                        });
                    },
                    error: function (xhr, status, error) {
                        // Handle errors
                        console.error(status + ": " + error);
                        $('#my_log').html(status + ": " + error);
                    }
                });
            }

        });


    </script>


</body>

</html>