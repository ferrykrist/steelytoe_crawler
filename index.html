<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Stellytoe Crawler</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="..." crossorigin="anonymous">

</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-4 ">
                <form>
                    <div class="form-group mt-2">
                        <h4 class="text-center">Stellytoe Image Crawler</h4>
                    </div>
                    <div class="form-group">
                        <label for="my_url">URL</label>
                        <input type="text" class="form-control" id="my_url" name="my_url" value="https://steelytoe.com/dev.titudev.com//api/v1/resources/master_file_tagging">
                    </div>
                    <div class="form-group">
                        <label for="my_event">Event Name</label>
                        <select class="form-control" id="my_event" name="my_event">
                            <option value="BOROBUDUR MARATHON 2024">BOROBUDUR MARATHON 2024</option>
                            <option value="TheBigTour Semarang">TheBigTour Semarang 2024</option>
                            <option value="BOROBUDUR MARATHON 2023">BOROBUDUR MARATHON 2023</option>
                            <option value="FRIENDSHIP-RUN-SEMARANG-2023">BOROBUDUR FRIENDSHIP RUN 2023</option>
                            <option value="SEMARANG 10K 2024">Semarang 10K 2024</option>
                            <option value="SEMARANG 10K 2023">Semarang 10K 2023</option>
                            <option value="SEMARANG-10K-2022">Semarang 10K 2022</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="my_bib">BIB/Name Search</label>
                        <input type="text" class="form-control" id="my_bib" name="my_bib">
                    </div>
                    <div class="form-group">
                        <label for="my_location">Location, e.g., startline, 10K, etc</label><br>
                        <input type="text" class="form-control" id="my_location" name="my_location">
                    </div>
                    <div class="form-group">
                        <label for="my_pagenumber">Udah, pakai page number saja!</label><br>
                        <input type="text" class="form-control" id="my_pagenumber" name="my_pagenumber">
                    </div>
                    <div class="form-group">
                        <label for="my_photoid">Coba cari menggunakan ID, mungkin fotomu terselip!</label><br>
                        <input type="text" class="form-control" id="my_photoid" name="my_photoid">
                    </div>
                    <div class="form-group">
                        <label for="my_photographer">Cari pakai nama fotografer (tulis tanpa @)</label><br>
                        <input type="text" class="form-control" id="my_photographer" name="my_photographer">
                    </div>

                    <div class="form-group">
                        <label for="my_pagesize">Jumlah foto yang mau ditampilkan</label>
                        <input type="text" class="form-control" id="my_pagesize" name="my_pagesize" value="30">
                    </div>
                    <div class="form-check">
                        <input checked class="form-check-input" type="checkbox" value="" id="filter_bib">
                        <label class="form-check-label" for="filter_bib">
                            Filter by BIB/Name
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_location">
                        <label class="form-check-label" for="filter_location">
                            Filter by Location
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_pagenumber">
                        <label class="form-check-label" for="filter_pagenumber">
                            Filter pakai page number, kelamaan kalau harus klik Next !
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_photoid">
                        <label class="form-check-label" for="filter_photoid">
                            Filter by Photo ID
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_photographer">
                        <label class="form-check-label" for="filter_photographer">
                            Filter by Photographer
                        </label>
                    </div>

                    <button type="button" id="searchButton" class="btn btn-primary w-100">Search!</button>

                    <!-- Existing HTML structure with the form and other elements -->

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between">
                                <small>
                                    <p class="text-left" id="my_log"></p>
                                    <p class="text-left" id="my_pageinfo"></p>
                                </small>
                            </div>

                        </div>



                    </div>
                    <!-- Buttons for navigation -->
                    <div class="row ml-1 mt-2 d-none" id="my_buttons">
                        <button type="button" class="btn btn-secondary mx-1 firstButton">First</button>
                        <button type="button" class="btn btn-secondary mx-1 previousButton">Previous</button>
                        <button type="button" class="btn btn-secondary mx-1 nextButton">Next</button>
                        <button type="button" class="btn btn-secondary mx-1 lastButton">Last</button>
                    </div>
                    <div class="row m-2">
                        <h5>Baca ini dulu kak!</h5>
                        <ul class="small">
                            <li><strong>Foto memang tidak bisa langsung di-download karena bukan punya web ini!</strong></li>
                            <li>Crawler ini bisa menampilkan foto anda sekaligus supaya tidak capek scroll halaman web penyelenggara lomba (belum lagi kalau nanti error)</li>
                            <li>Btw, koneksi internet berpengaruh ya. Loading lambat itu murni dari internet anda. Tipsnya jangan tampilkan foto banyak2.</li>
                            <li>Kadang dari Steelytoe memblokir akses, sehingga tombol Next tidak bekerja, solusinya isikan saja page number </li>
                            <li>Cari dulu BIB/nama anda, jangan lupa centang Filter by BIB/Name </li>
                            <li>Foto tidak keluar walau BIB/Nama sudah di-input? Mungkin dari SteelyToe belum selesai proses Image to text </li>
                            <li>Mau cari berdasarkan lokasi? Cari BIB anda, lalu perhatikan Location yang ditampilkan. Misal: 10K, HM, FM, KM 6,5, dst </li>
                            <li>Anda nganggur dan mau browse ribuan foto? Kosongkan semua inputan, lalu klik Search</li>
                            <li>Capek kalau harus klik next? masukkan page number lalu klik Search</li>

                        </ul>
                    </div>

                </form>
            </div>
            <div class="col-lg-8 mt-4">
                <!-- Buttons for navigation -->
                <div class="row ml-1 mt-2 d-none" id="my_buttons2">
                    <button type="button" class="btn btn-secondary mx-1 firstButton">First</button>
                    <button type="button" class="btn btn-secondary mx-1 previousButton">Previous</button>
                    <button type="button" class="btn btn-secondary mx-1 nextButton">Next</button>
                    <button type="button" class="btn btn-secondary mx-1 lastButton">Last</button>
                </div>
                <div class="row">
                    <div class="col-lg-12" id="div2">

                    </div>
                </div>
                <!-- Buttons for navigation -->
                <div class="row ml-1 mt-2 d-none" id="my_buttons3">
                    <button type="button" class="btn btn-secondary mx-1 firstButton">First</button>
                    <button type="button" class="btn btn-secondary mx-1 previousButton">Previous</button>
                    <button type="button" class="btn btn-secondary mx-1 nextButton">Next</button>
                    <button type="button" class="btn btn-secondary mx-1 lastButton">Last</button>
                    <button type="button" class="btn btn-secondary mx-1 scrollToTopButton">Back to Top</button>

                </div>

            </div>

        </div>
    </div>
    <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="" id="modalImage" class="img-fluid" alt="Modal Image">
                </div>
            </div>
        </div>
    </div>



    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Your jQuery functionality can go here -->
    <script>

        function updateInputValue(selector, value) {
            $(selector).val(value);
        }

        function generateRowImages(result) {
            let imageList = '<div class="row">';
            $.each(result.data, function (index, photo) {
                imageList += `
                    <div class="col-lg-3 my-1">
                        <img src="${photo.mftgUrl}" class="img-fluid mb-2 image-popup" alt="Event Image"
                            data-toggle="modal" data-target="#imageModal" data-image="${photo.mftgUrl}">
                        <small>
                            <div class="d-flex justify-content-between align-items-start">
                                <p class="mb-0 float-left text-sm" style="line-height:1.1">
                                    <strong>Location:</strong> <a style="cursor:pointer;" onclick="updateInputValue('#my_location', '${photo.mftgPhotoLocation}')">${photo.mftgPhotoLocation}</a><br>
                                    <strong>ID:</strong> <a style="cursor:pointer;" onclick="updateInputValue('#my_photoid', '${photo.mftgMfilId}')">${photo.mftgMfilId}</a><br>
                                    <strong>Photographer:</strong> <a style="cursor:pointer;" onclick="updateInputValue('#my_photographer', '${photo.mftgFotografer.replace('@', '')}')">${photo.mftgFotografer}</a>
                                </p>
                                <a href="${photo.mftgUrl}" target="_blank"  class="text-sm-right ml-2">Download</a>
                            </div>
                        </small>
                    </div>`;
            });
            return imageList + '</div>';
        }

        function generateParams() {
            const queryParams = {
                pageSize: $('#my_pagesize').val(),
                pageNumber: 1,
                sort: '+mftgPhotoDate',
                'filter[mftgEventName]': $('#my_event').val()
            };

            const filters = [
                { key: 'mftgPhotoLocation', value: $('#my_location').val(), isChecked: $('#filter_location').prop('checked') },
                { key: 'mftgDescription', value: $('#my_bib').val(), isChecked: $('#filter_bib').prop('checked') },
                { key: 'mftgMfilId', value: $('#my_photoid').val(), isChecked: $('#filter_photoid').prop('checked') },
                { key: 'mftgFotografer', value: $('#my_photographer').val(), isChecked: $('#filter_photographer').prop('checked') }
            ];

            filters.forEach(filter => {
                if (filter.isChecked) {
                    queryParams[`filter[${filter.key}][like]`] = `%${filter.value}%`;
                }
            });

            if ($('#filter_pagenumber').prop('checked')) {
                queryParams.pageNumber = $('#my_pagenumber').val();
            }
            return queryParams;
        }

        function triggerAjax(params) {
            $('#div2').html('<h4>Tunggu sebentar sedang loading...</h4>');
            $('#my_pageinfo').html(`Sekarang ada di halaman: ${params.pageNumber}`);

            $.ajax({
                url: $('#my_url').val(),
                method: 'GET',
                data: params,
                success: function (response) {
                    $('#div2').html(generateRowImages(response));
                    $('.image-popup').click(function () {
                        $('#modalImage').attr('src', $(this).data('image'));
                    });
                    if (params.pageSize < response.status.totalRecords) {
                        $('#my_buttons').removeClass('d-none');
                        $('#my_buttons2').removeClass('d-none');
                        $('#my_buttons3').removeClass('d-none');

                    }
                    updateNavigation(response.status.totalRecords, params);
                },
                error: function (xhr, status, error) {
                    console.error(`${status}: ${error}`);
                    $('#div2').html('<h4>Error. Yang kamu cari gak ketemu!</h4>');
                }
            });
        }

        function updateNavigation(totalRecords, params) {
            const pageSize = params.pageSize;
            const totalPages = Math.ceil(totalRecords / pageSize);
            $('#my_log').html(`Total ada ${totalRecords} Foto dan ${totalPages} halaman`);

            ['.firstButton', '.previousButton', '.nextButton', '.lastButton'].forEach(selector => {
                $(selector).off('click');
            });

            $('.firstButton').click(() => { params.pageNumber = 1; triggerAjax(params); });
            $('.previousButton').click(() => { if (params.pageNumber > 1) params.pageNumber--; triggerAjax(params); });
            $('.nextButton').click(() => { if (params.pageNumber < totalPages) params.pageNumber++; triggerAjax(params); });
            $('.lastButton').click(() => { params.pageNumber = totalPages; triggerAjax(params); });
        }

        $(document).ready(function () {
            $('#searchButton').click(function () {
                const queryParams = generateParams();
                console.log(queryParams);
                triggerAjax(queryParams);
            });

            $('.scrollToTopButton').click(function () {
                $('html, body').animate({ scrollTop: 0 }, 'smooth');
            });
        });
    </script>



</body>

</html>