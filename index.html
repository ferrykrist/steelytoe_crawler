<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Stellytoe Crawler</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="..." crossorigin="anonymous">

</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-4 ">
                <form>
                    <div class="form-group mt-2">
                        <h4 class="text-center">Stellytoe Image Crawler</h4>
                    </div>
                    <div class="form-group">
                        <label for="my_url">URL</label>
                        <input type="text" class="form-control" id="my_url" name="my_url" value="https://steelytoe.com/dev.titudev.com//api/v1/resources/master_file_tagging">
                    </div>
                    <div class="form-group">
                        <label for="my_event">Event Name</label>
                        <select class="form-control" id="my_event" name="my_event">
                            <option value="BOROBUDUR MARATHON 2023">BOROBUDUR MARATHON 2023</option>
                            <option value="FRIENDSHIP-RUN-SEMARANG-2023">BOROBUDUR FRIENDSHIP RUN 2023</option>
                            <option value="SEMARANG-10K-2022">Semarang 10K 2022</option>
                            <option value="SEMARANG-10K-2023">Semarang 10K 2023</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="my_bib">BIB/Name Search</label>
                        <input type="text" class="form-control" id="my_bib" name="my_bib">
                    </div>
                    <div class="form-group">
                        <label for="my_location">Location, e.g., startline, 10K, etc</label><br>
                        <small>Tips: cari dulu tanpa location, setelah itu perhatikan informasi lokasi yang ditampilkan</small>
                        <input type="text" class="form-control" id="my_location" name="my_location">
                    </div>
                    <div class="form-group">
                        <label for="my_pagenumber">Udah, pakai page number saja!</label><br>
                        <input type="text" class="form-control" id="my_pagenumber" name="my_pagenumber">
                    </div>

                    <div class="form-group">
                        <label for="my_pagesize">Page Size</label>
                        <input type="text" class="form-control" id="my_pagesize" name="my_pagesize" value="100">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_location">
                        <label class="form-check-label" for="filter_location">
                            Filter by Location
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_bib">
                        <label class="form-check-label" for="filter_bib">
                            Filter by BIB/Name
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filter_pagenumber">
                        <label class="form-check-label" for="filter_pagenumber">
                            Use page number, kelamaan kalau harus klik Next !
                        </label>
                    </div>

                    <button type="button" class="btn btn-primary w-100">Search!</button>

                    <!-- Existing HTML structure with the form and other elements -->

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between">
                                <p class="text-left" id="my_log"></p>
                                <p class="text-right" id="my_pageinfo"></p>
                            </div>

                        </div>



                    </div>
                    <!-- Buttons for navigation -->
                    <div class="row ml-1 mt-2 d-none" id="my_buttons">
                        <button type="button" class="btn btn-secondary mx-1" id="my_firstButton">First</button>
                        <button type="button" class="btn btn-secondary mx-1" id="my_previousButton">Previous</button>
                        <button type="button" class="btn btn-secondary mx-1" id="my_nextButton">Next</button>
                        <button type="button" class="btn btn-secondary mx-1" id="my_lastButton">Last</button>

                    </div>

                </form>
            </div>
            <div class="col-lg-8 mt-4">
                <div class="col-lg-12">
                    <div id="div2">

                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="" id="modalImage" class="img-fluid" alt="Modal Image">
                </div>
            </div>
        </div>
    </div>



    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Your jQuery functionality can go here -->
    <script>
        $(document).ready(function () {

            $('button').click(function () {
                var url = $('#my_url').val();
                var pageSize = $('#my_pagesize').val();
                var eventName = $('#my_event').val();
                var queryParams = {
                    pageSize: pageSize,
                    pageNumber: 1,
                    sort: '+mftgPhotoDate',
                    'filter[mftgEventName]': eventName
                };

                var bibSearch = $('#my_bib').val();
                var locationValue = $('#my_location').val();
                var pagenumberValue = $('#my_pagenumber').val();


                var locationFilter = $('#filter_location').prop('checked');
                var bibFilter = $('#filter_bib').prop('checked');
                var pagenumberFilter = $('#filter_pagenumber').prop('checked');


                if (locationFilter) {
                    queryParams['filter[mftgPhotoLocation][like]'] = '%' + locationValue + '%';
                }
                if (bibFilter) {
                    queryParams['filter[mftgDescription][like]'] = '%' + bibSearch + '%';
                }
                if (pagenumberFilter) {
                    queryParams.pageNumber = pagenumberValue;
                }
                $('#div2').html('');

                $.ajax({
                    url: url,
                    method: 'GET',
                    data: queryParams,
                    success: function (response) {
                        var imageList = '<div class="row">';
                        $.each(response.data, function (index, photo) {
                            imageList += '<div class="col-lg-3">';
                            imageList += '<img src="' + photo.mftgUrl + '" class="img-fluid mb-2 image-popup" alt="Event Image" data-toggle="modal" data-target="#imageModal" data-image="' + photo.mftgUrl + '">';
                            imageList += '<small>'
                            imageList += '<div class="d-flex justify-content-between align-items-start">';
                            imageList += '<p class="mb-0 float-left"><strong>Location:</strong> ' + photo.mftgPhotoLocation + '</p>';
                            imageList += '<a href="' + photo.mftgUrl + '" target=_blank class="text-sm-right ml-2">download</a>';
                            imageList += '</div>';
                            imageList += '</small>';
                            imageList += '</div>';


                        });
                        imageList += '</div>';
                        $('#div2').html(imageList);
                        // Open modal on image click
                        $('.image-popup').click(function () {
                            var imageUrl = $(this).data('image');
                            $('#modalImage').attr('src', imageUrl);
                        });
                        $('#my_log').html('Total ada ' + response.status.totalRecords + ' Foto');
                        if (pageSize < response.status.totalRecords) {
                            $('#my_buttons').removeClass('d-none');
                        }
                        updateNavigation(response.status.totalRecords, queryParams);
                    },

                    error: function (xhr, status, error) {
                        // Handle errors here
                        console.error(status + ": " + error);
                        $('#my_log').html(status + ": " + error);
                    }
                });


            });

            // Function to update navigation buttons
            function updateNavigation(totalRecords, params) {
                var queryParams = params;
                var pageSize = $('#my_pagesize').val();
                var totalPages = Math.ceil(totalRecords / pageSize);
                var $firstButton = $('#my_firstButton');
                var $previousButton = $('#my_previousButton');
                var $nextButton = $('#my_nextButton');
                var $lastButton = $('#my_lastButton');

                $nextButton.off('click');
                $previousButton.off('click');
                $lastButton.off('click');
                $firstButton.off('click');

                $firstButton.click(function () {
                    queryParams.pageNumber = 1;
                    triggerAjax(queryParams);
                });

                $previousButton.click(function () {
                    var newPagenumber = queryParams.pageNumber - 1;
                    if (newPagenumber >= 1) {
                        queryParams.pageNumber--;
                        triggerAjax(queryParams);
                    }
                });

                $nextButton.click(function () {
                    var newPagenumber = queryParams.pageNumber + 1;
                    if (newPagenumber < totalPages) {
                        queryParams.pageNumber++;
                        triggerAjax(queryParams);
                    }
                });

                $lastButton.click(function () {
                    queryParams.pageNumber = totalPages;
                    triggerAjax(queryParams);
                });


            };
            function triggerAjax(params) {
                // Make AJAX call with updated page number (queryParams.pageNumber)
                var url = $('#my_url').val();
                var queryParams = params;
                $('#div2').html('');
                $('#my_pageinfo').html('Sekarang ada di halaman: ' + params.pageNumber);

                $.ajax({
                    url: url,
                    method: 'GET',
                    data: queryParams,
                    success: function (response) {
                        var imageList = '<div class="row">';
                        $.each(response.data, function (index, photo) {
                            imageList += '<div class="col-lg-3">';
                            imageList += '<img src="' + photo.mftgUrl + '" class="img-fluid mb-2 image-popup" alt="Event Image" data-toggle="modal" data-target="#imageModal" data-image="' + photo.mftgUrl + '">';
                            imageList += '<small>'
                            imageList += '<div class="d-flex justify-content-between align-items-start">';
                            imageList += '<p class="mb-0 float-left"><strong>Location:</strong> ' + photo.mftgPhotoLocation + '</p>';
                            imageList += '<a href="' + photo.mftgUrl + '" target=_blank class="text-sm-right ml-2">download</a>';
                            imageList += '</div>';
                            imageList += '</small>';
                            imageList += '</div>';
                        });
                        imageList += '</div>';
                        $('#div2').html(imageList);
                        // Open modal on image click
                        $('.image-popup').click(function () {
                            var imageUrl = $(this).data('image');
                            $('#modalImage').attr('src', imageUrl);
                        });
                    },
                    error: function (xhr, status, error) {
                        // Handle errors
                        console.error(status + ": " + error);
                        $('#my_log').html(status + ": " + error);
                    }
                });
            }

        });


    </script>


</body>

</html>